// Question bank for interactive quiz game
// Contains pre-built questions across different categories

export const QUESTION_CATEGORIES = {
  SCIENCE: 'science',
  MATHEMATICS: 'mathematics',
  GENERAL_KNOWLEDGE: 'general_knowledge',
  HISTORY: 'history'
};

export const QUESTION_BANK = {
  [QUESTION_CATEGORIES.SCIENCE]: [
    {
      id: 'sci_1',
      questionKey: 'question_sci_1',
      answerKey: 'answer_sci_1',
      difficulty: 'easy',
      points: 10
    },
    {
      id: 'sci_2',
      questionKey: 'question_sci_2',
      answerKey: 'answer_sci_2',
      difficulty: 'easy',
      points: 10
    },
    {
      id: 'sci_3',
      questionKey: 'question_sci_3',
      answerKey: 'answer_sci_3',
      difficulty: 'medium',
      points: 15
    },
    {
      id: 'sci_4',
      questionKey: 'question_sci_4',
      answerKey: 'answer_sci_4',
      difficulty: 'medium',
      points: 15
    },
    {
      id: 'sci_5',
      questionKey: 'question_sci_5',
      answerKey: 'answer_sci_5',
      difficulty: 'medium',
      points: 15
    },
    {
      id: 'sci_6',
      questionKey: 'question_sci_6',
      answerKey: 'answer_sci_6',
      difficulty: 'easy',
      points: 10
    },
    {
      id: 'sci_7',
      questionKey: 'question_sci_7',
      answerKey: 'answer_sci_7',
      difficulty: 'easy',
      points: 10
    },
    {
      id: 'sci_8',
      questionKey: 'question_sci_8',
      answerKey: 'answer_sci_8',
      difficulty: 'medium',
      points: 15
    },
    {
      id: 'sci_9',
      questionKey: 'question_sci_9',
      answerKey: 'answer_sci_9',
      difficulty: 'medium',
      points: 15
    },
    {
      id: 'sci_10',
      questionKey: 'question_sci_10',
      answerKey: 'answer_sci_10',
      difficulty: 'hard',
      points: 20
    },
    {
      id: 'sci_11',
      questionKey: 'question_sci_11',
      answerKey: 'answer_sci_11',
      difficulty: 'hard',
      points: 20
    },
    {
      id: 'sci_12',
      questionKey: 'question_sci_12',
      answerKey: 'answer_sci_12',
      difficulty: 'hard',
      points: 20
    },
    {
      id: 'sci_13',
      questionKey: 'question_sci_13',
      answerKey: 'answer_sci_13',
      difficulty: 'medium',
      points: 15
    },
    {
      id: 'sci_14',
      questionKey: 'question_sci_14',
      answerKey: 'answer_sci_14',
      difficulty: 'hard',
      points: 20
    },
    {
      id: 'sci_15',
      questionKey: 'question_sci_15',
      answerKey: 'answer_sci_15',
      difficulty: 'hard',
      points: 20
    }
  ],

  [QUESTION_CATEGORIES.MATHEMATICS]: [
    {
      id: 'math_1',
      questionKey: 'question_math_1',
      answerKey: 'answer_math_1',
      difficulty: 'easy',
      points: 10
    },
    {
      id: 'math_2',
      questionKey: 'question_math_2',
      answerKey: 'answer_math_2',
      difficulty: 'easy',
      points: 10
    },
    {
      id: 'math_3',
      questionKey: 'question_math_3',
      answerKey: 'answer_math_3',
      difficulty: 'medium',
      points: 15
    },
    {
      id: 'math_4',
      questionKey: 'question_math_4',
      answerKey: 'answer_math_4',
      difficulty: 'easy',
      points: 10
    },
    {
      id: 'math_5',
      questionKey: 'question_math_5',
      answerKey: 'answer_math_5',
      difficulty: 'easy',
      points: 10
    },
    {
      id: 'math_6',
      questionKey: 'question_math_6',
      answerKey: 'answer_math_6',
      difficulty: 'medium',
      points: 15
    },
    {
      id: 'math_7',
      questionKey: 'question_math_7',
      answerKey: 'answer_math_7',
      difficulty: 'medium',
      points: 15
    },
    {
      id: 'math_8',
      questionKey: 'question_math_8',
      answerKey: 'answer_math_8',
      difficulty: 'medium',
      points: 15
    },
    {
      id: 'math_9',
      questionKey: 'question_math_9',
      answerKey: 'answer_math_9',
      difficulty: 'hard',
      points: 20
    },
    {
      id: 'math_10',
      questionKey: 'question_math_10',
      answerKey: 'answer_math_10',
      difficulty: 'hard',
      points: 20
    },
    {
      id: 'math_11',
      questionKey: 'question_math_11',
      answerKey: 'answer_math_11',
      difficulty: 'hard',
      points: 20
    },
    {
      id: 'math_12',
      questionKey: 'question_math_12',
      answerKey: 'answer_math_12',
      difficulty: 'easy',
      points: 10
    },
    {
      id: 'math_13',
      questionKey: 'question_math_13',
      answerKey: 'answer_math_13',
      difficulty: 'medium',
      points: 15
    },
    {
      id: 'math_14',
      questionKey: 'question_math_14',
      answerKey: 'answer_math_14',
      difficulty: 'hard',
      points: 20
    },
    {
      id: 'math_15',
      questionKey: 'question_math_15',
      answerKey: 'answer_math_15',
      difficulty: 'hard',
      points: 20
    }
  ],

  [QUESTION_CATEGORIES.GENERAL_KNOWLEDGE]: [
    {
      id: 'gk_1',
      questionKey: 'question_gk_1',
      answerKey: 'answer_gk_1',
      difficulty: 'easy',
      points: 10
    },
    {
      id: 'gk_2',
      questionKey: 'question_gk_2',
      answerKey: 'answer_gk_2',
      difficulty: 'easy',
      points: 10
    },
    {
      id: 'gk_3',
      questionKey: 'question_gk_3',
      answerKey: 'answer_gk_3',
      difficulty: 'easy',
      points: 10
    },
    {
      id: 'gk_4',
      questionKey: 'question_gk_4',
      answerKey: 'answer_gk_4',
      difficulty: 'easy',
      points: 10
    },
    {
      id: 'gk_5',
      questionKey: 'question_gk_5',
      answerKey: 'answer_gk_5',
      difficulty: 'medium',
      points: 15
    },
    {
      id: 'gk_6',
      questionKey: 'question_gk_6',
      answerKey: 'answer_gk_6',
      difficulty: 'medium',
      points: 15
    },
    {
      id: 'gk_7',
      questionKey: 'question_gk_7',
      answerKey: 'answer_gk_7',
      difficulty: 'medium',
      points: 15
    },
    {
      id: 'gk_8',
      questionKey: 'question_gk_8',
      answerKey: 'answer_gk_8',
      difficulty: 'medium',
      points: 15
    },
    {
      id: 'gk_9',
      questionKey: 'question_gk_9',
      answerKey: 'answer_gk_9',
      difficulty: 'hard',
      points: 20
    },
    {
      id: 'gk_10',
      questionKey: 'question_gk_10',
      answerKey: 'answer_gk_10',
      difficulty: 'hard',
      points: 20
    },
    {
      id: 'gk_11',
      questionKey: 'question_gk_11',
      answerKey: 'answer_gk_11',
      difficulty: 'easy',
      points: 10
    },
    {
      id: 'gk_12',
      questionKey: 'question_gk_12',
      answerKey: 'answer_gk_12',
      difficulty: 'medium',
      points: 15
    },
    {
      id: 'gk_13',
      questionKey: 'question_gk_13',
      answerKey: 'answer_gk_13',
      difficulty: 'hard',
      points: 20
    },
    {
      id: 'gk_14',
      questionKey: 'question_gk_14',
      answerKey: 'answer_gk_14',
      difficulty: 'hard',
      points: 20
    },
    {
      id: 'gk_15',
      questionKey: 'question_gk_15',
      answerKey: 'answer_gk_15',
      difficulty: 'hard',
      points: 20
    }
  ],

  [QUESTION_CATEGORIES.HISTORY]: [
    {
      id: 'hist_1',
      questionKey: 'question_hist_1',
      answerKey: 'answer_hist_1',
      difficulty: 'easy',
      points: 10
    },
    {
      id: 'hist_2',
      questionKey: 'question_hist_2',
      answerKey: 'answer_hist_2',
      difficulty: 'medium',
      points: 15
    },
    {
      id: 'hist_3',
      questionKey: 'question_hist_3',
      answerKey: 'answer_hist_3',
      difficulty: 'easy',
      points: 10
    },
    {
      id: 'hist_4',
      questionKey: 'question_hist_4',
      answerKey: 'answer_hist_4',
      difficulty: 'easy',
      points: 10
    },
    {
      id: 'hist_5',
      questionKey: 'question_hist_5',
      answerKey: 'answer_hist_5',
      difficulty: 'medium',
      points: 15
    },
    {
      id: 'hist_6',
      questionKey: 'question_hist_6',
      answerKey: 'answer_hist_6',
      difficulty: 'medium',
      points: 15
    },
    {
      id: 'hist_7',
      questionKey: 'question_hist_7',
      answerKey: 'answer_hist_7',
      difficulty: 'medium',
      points: 15
    },
    {
      id: 'hist_8',
      questionKey: 'question_hist_8',
      answerKey: 'answer_hist_8',
      difficulty: 'hard',
      points: 20
    },
    {
      id: 'hist_9',
      questionKey: 'question_hist_9',
      answerKey: 'answer_hist_9',
      difficulty: 'hard',
      points: 20
    },
    {
      id: 'hist_10',
      questionKey: 'question_hist_10',
      answerKey: 'answer_hist_10',
      difficulty: 'easy',
      points: 10
    },
    {
      id: 'hist_11',
      questionKey: 'question_hist_11',
      answerKey: 'answer_hist_11',
      difficulty: 'medium',
      points: 15
    },
    {
      id: 'hist_12',
      questionKey: 'question_hist_12',
      answerKey: 'answer_hist_12',
      difficulty: 'hard',
      points: 20
    },
    {
      id: 'hist_13',
      questionKey: 'question_hist_13',
      answerKey: 'answer_hist_13',
      difficulty: 'hard',
      points: 20
    },
    {
      id: 'hist_14',
      questionKey: 'question_hist_14',
      answerKey: 'answer_hist_14',
      difficulty: 'medium',
      points: 15
    },
    {
      id: 'hist_15',
      questionKey: 'question_hist_15',
      answerKey: 'answer_hist_15',
      difficulty: 'hard',
      points: 20
    }
  ]
};

// Quiz game service class
export class QuizGameService {
  constructor() {
    this.currentGame = null;
  }

  createGame(config) {
    const game = {
      id: this.generateGameId(),
      teams: this.generateTeams(config.numberOfTeams, config.teamNames),
      totalQuestions: config.totalQuestions,
      questionSource: config.questionSource,
      selectedCategories: config.selectedCategories || [],
      customQuestions: config.customQuestions || [],
      currentQuestionIndex: 0,
      currentTeamIndex: 0,
      questions: [],
      gameState: 'setup',
      teacherTeam: {
        name: 'Teacher Team',
        score: 0,
        isTeacherTeam: true
      },
      settings: {
        pointsPerQuestion: config.pointsPerQuestion || 10,
        allowManualScoring: true
      },
      createdAt: new Date().toISOString()
    };

    game.questions = this.generateQuestions(game);
    this.currentGame = game;
    
    return game;
  }

  generateTeams(numberOfTeams, customNames = []) {
    const teams = [];
    const defaultNames = ['Team A', 'Team B', 'Team C', 'Team D', 'Team E', 'Team F'];
    
    for (let i = 0; i < numberOfTeams; i++) {
      teams.push({
        id: `team_${i + 1}`,
        name: customNames[i] || defaultNames[i] || `Team ${String.fromCharCode(65 + i)}`,
        score: 0,
        answeredQuestions: [],
        isActive: i === 0
      });
    }
    
    return teams;
  }

  generateQuestions(game) {
    let questions = [];

    if (game.questionSource === 'built-in') {
      game.selectedCategories.forEach(category => {
        if (QUESTION_BANK[category]) {
          questions = questions.concat(QUESTION_BANK[category]);
        }
      });
    } else if (game.questionSource === 'custom') {
      questions = game.customQuestions;
    }

    questions = this.shuffleArray(questions);
    return questions.slice(0, game.totalQuestions);
  }

  shuffleArray(array) {
    const shuffled = [...array];
    for (let i = shuffled.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
    }
    return shuffled;
  }

  generateGameId() {
    return `quiz_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;
  }

  getCurrentQuestion(game = this.currentGame) {
    if (!game || game.currentQuestionIndex >= game.questions.length) {
      return null;
    }
    return game.questions[game.currentQuestionIndex];
  }

  getCurrentTeam(game = this.currentGame) {
    if (!game) return null;
    return game.teams[game.currentTeamIndex];
  }

  nextTeam(game = this.currentGame) {
    if (!game) return;
    
    game.teams[game.currentTeamIndex].isActive = false;
    game.currentTeamIndex = (game.currentTeamIndex + 1) % game.teams.length;
    game.teams[game.currentTeamIndex].isActive = true;
    
    return game.teams[game.currentTeamIndex];
  }

  nextQuestion(game = this.currentGame) {
    if (!game) return false;
    
    game.currentQuestionIndex++;
    
    game.teams.forEach(team => team.isActive = false);
    game.currentTeamIndex = 0;
    game.teams[0].isActive = true;
    
    if (game.currentQuestionIndex >= game.questions.length) {
      game.gameState = 'finished';
      return false;
    }
    
    return true;
  }

  awardPoints(teamId, points, game = this.currentGame) {
    if (!game) return;
    
    if (teamId === 'teacher') {
      game.teacherTeam.score += points;
    } else {
      const team = game.teams.find(t => t.id === teamId);
      if (team) {
        team.score += points;
        team.answeredQuestions.push({
          questionId: this.getCurrentQuestion(game)?.id,
          points: points,
          timestamp: new Date().toISOString()
        });
      }
    }
  }

  getLeaderboard(game = this.currentGame) {
    if (!game) return [];
    
    const allParticipants = [...game.teams, game.teacherTeam];
    return allParticipants.sort((a, b) => b.score - a.score).map((participant, index) => ({
      ...participant,
      rank: index + 1
    }));
  }

  startQuiz(game = this.currentGame) {
    if (!game) return false;
    
    game.gameState = 'active';
    game.teams[0].isActive = true;
    return true;
  }

  getAvailableCategories() {
    return Object.entries(QUESTION_CATEGORIES).map(([key, value]) => ({
      id: value,
      name: key.charAt(0) + key.slice(1).toLowerCase().replace('_', ' '),
      questionCount: QUESTION_BANK[value]?.length || 0
    }));
  }
}

export const quizGameService = new QuizGameService();

// Legacy exports for backward compatibility
export const questionBank = QUESTION_BANK;

export const getAllCategories = () => {
  return Object.values(QUESTION_CATEGORIES);
};

export const getCategoryDisplayName = (category) => {
  const displayNames = {
    'science': 'Science',
    'mathematics': 'Mathematics', 
    'general_knowledge': 'General Knowledge',
    'history': 'History',
    'easy': 'Easy',
    'medium': 'Medium',
    'hard': 'Hard',
    'custom': 'Custom'
  };
  return displayNames[category] || category.charAt(0).toUpperCase() + category.slice(1);
};

export const getRandomQuestions = (category, count = 5) => {
  const questions = QUESTION_BANK[category] || [];
  const shuffled = [...questions].sort(() => 0.5 - Math.random());
  return shuffled.slice(0, count);
};

export const getMixedQuestions = (categories, totalCount = 10) => {
  let allQuestions = [];
  categories.forEach(category => {
    if (QUESTION_BANK[category]) {
      allQuestions = allQuestions.concat(QUESTION_BANK[category]);
    }
  });
  const shuffled = [...allQuestions].sort(() => 0.5 - Math.random());
  return shuffled.slice(0, totalCount);
};